<VirtualHost *:80>
    ServerName          data.salamanca.school
    ServerAdmin         admin@salamanca.school

    ErrorLog  /var/log/apache2/www.salamanca.school-error.log
    CustomLog /var/log/apache2/www.salamanca.school-access.log combined

    ProxyRequests       Off                       # We don't want to act as (open) forward proxy
    ProxyTimeout        432000

    ProxyPass /.well-known !
    Alias /.well-known "/var/www/vhosts/.well-known"
    <Directory "/var/www/vhosts/.well-known">
        Require all granted
        AllowOverride All
        AddDefaultCharset Off
        Header set Content-Type "text/plain"
    </Directory>

    ProxyPass           /   http://localhost:8080/exist/apps/salamanca/
    ProxyPassReverse    /   http://localhost:8080/exist/apps/salamanca/
    ProxyPassReverse    /   https://localhost:8443/exist/apps/salamanca/
</VirtualHost>

<VirtualHost *:443>
    ServerName          data.salamanca.school
    ServerAdmin         admin@salamanca.school

    ErrorLog  /var/log/apache2/www.salamanca.school-error.log
    CustomLog /var/log/apache2/www.salamanca.school-access.log combined

    ProxyRequests       Off                 # We don't want to act as (open) forward proxy
    ProxyTimeout        432000

    ProxyPass           /   http://localhost:8080/exist/apps/salamanca/
    ProxyPassReverse    /   http://localhost:8080/exist/apps/salamanca/
    ProxyPassReverse    /   https://localhost:8443/exist/apps/salamanca/

    ProxyPassReverseCookiePath /exist /
    ProxyPassReverseCookieDomain localhost data.salamanca.school

    RequestHeader set X-Forwarded-Proto "https" env=HTTPS

    # necessary for authentication problem:
    RequestHeader unset X-Forwarded-Host

    SSLEngine on
SSLCertificateFile /etc/letsencrypt/live/salamanca.school/fullchain.pem
SSLCertificateKeyFile /etc/letsencrypt/live/salamanca.school/privkey.pem
    SSLProtocol ALL -SSLv3
    SSLHonorCipherOrder On
    SSLCipherSuite ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:RSA+AESGCM:RSA+AES:!aNULL:!MD5:!DSS
    SSLCompression Off

</VirtualHost>
