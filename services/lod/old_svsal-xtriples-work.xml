<xtriples xml:base="https://id.salamanca.school/">
    <configuration>
        <vocabularies>
            <!-- Input vocabularies -->
            <vocabulary prefix="tei" uri="http://www.tei-c.org/ns/1.0"/>
            <vocabulary prefix="xi" uri="http://www.w3.org/2001/XInclude"/>
            <vocabulary prefix="sal" uri="http://salamanca.adwmainz.de"/>               

            <!-- Output vocabularies -->
            <vocabulary prefix="rdf" uri="http://www.w3.org/1999/02/22-rdf-syntax-ns#"/>
            <vocabulary prefix="rdfs" uri="http://www.w3.org/2000/01/rdf-schema#"/>
            <vocabulary prefix="owl" uri="http://www.w3.org/2002/07/owl#"/>        

            <vocabulary prefix="void" uri="http://rdfs.org/ns/void#"/>
            <vocabulary prefix="iiif" uri="http://iiif.io/api/presentation/2.1/"/>
            <vocabulary prefix="foaf" uri="http://xmlns.com/foaf/0.1/"/>            
            <vocabulary prefix="book" uri="http://schema.org/Book/"/>               
            <vocabulary prefix="fabio" uri="http://purl.org/spar/fabio/"/>           
            <vocabulary prefix="cito" uri="http://purl.org/spar/cito/"/>            
            <vocabulary prefix="doco" uri="http://purl.org/spar/doco/"/>            
            <vocabulary prefix="po" uri="http://www.essepuntato.it/2008/12/pattern#"/> 
<!--            <vocabulary prefix="c40" uri="http://purl.org/spar/c4o"/>              -->
<!--            <vocabulary prefix="deo" uri="http://purl.org/spar/deo"/>              -->
<!--            <vocabulary prefix="co" uri="http://purl.org/co/"/>                    -->
        </vocabularies>

        <triples>

<!-- TODO/General:
    - Try to get rid of string() so that values are not isolated from their (indexed) nodes (ML suggestion by Joe Wicentowski)
    - better use union of full xpaths than or'ing predicates/conditions (intersect instead of and'ing, too?)
-->


            <statement n="0">
                <condition>/($currentResource//tei:relatedItem[@type eq "work_volume"])</condition>
                <subject type="uri"/>
                <predicate prefix="void">inDataset</predicate>
                <object type="uri" prepend="https://api.salamanca.school/texts/">void.ttl#Salamanca</object>
            </statement>


<!-- ============================================================= -->
<!-- === I. Bibliographic Metadata: Type, Title, Creator, Year === -->  
<!-- ============================================================= -->

<!-- TODO/Bibliographic:
    - fabio:has language
    - fabio:has page count
    - deo:dedication
    - book:mentions (organisations)
    - cito:isCitedBy?
    ! test reification of cito:cites in order to associate po:isContainedBy
    ! corresponds to an oclc dataset?
-->
            
            
            <statement n="1"><!-- a fabio:work -->
                <subject type="uri" prepend="texts/">/($currentResource//@docId)</subject>
                <predicate prefix="rdf">type</predicate>
                <object type="uri" prefix="fabio">work</object>
            </statement>
            <statement n="2"><!-- fabio:hasTitle -->
                <subject type="uri" prepend="texts/">/($currentResource//@docId)</subject> <!-- /@work -->
                <predicate prefix="fabio">hasTitle</predicate>
                <object type="literal">/($currentResource//tei:titleStmt//tei:title[@type eq 'main']/text())</object>
            </statement>
            <statement n="3"><!-- fabio:hasCreator -->
                <subject type="uri" prepend="texts/">/($currentResource//@docId)</subject>
                <predicate prefix="fabio">hasCreator</predicate>
                <object type="uri" prepend="authors.">(for $t in $currentResource//tei:titleStmt//tei:author/tei:persName/tokenize(tokenize(@ref, 'author:')[2], ' ')[1] return element t {$t})</object>
            </statement>
            <statement n="4"><!-- fabio:hasPublicationYear -->
                <subject type="uri" prepend="texts/">/($currentResource//@docId)</subject>
                <predicate prefix="fabio">hasPublicationYear</predicate>
                <object type="literal">/($currentResource//tei:sourceDesc//tei:imprint/(tei:date[@type eq 'thisEd'], tei:date[@type eq 'firstEd'])[1]/@when)</object>
            </statement>
            
            <statement n="5"><!-- fabio:has short title -->
                <subject type="uri" prepend="texts/">/($currentResource//@docId)</subject>
                <predicate prefix="fabio">hasShortTitle</predicate>
                <object type="literal">/replace($currentResource//tei:titleStmt//tei:title[@type="short"], '"', '\\"')</object>
            </statement>
            
            <statement n="6"><!-- fabio:has publisher (in cerl) -->
                <subject type="uri" prepend="texts/">/($currentResource//@docId)</subject>
                <predicate prefix="fabio">hasPublisher</predicate>
                <object type="uri" prepend="http://thesaurus.cerl.org/record/">/(for $t in $currentResource//tei:sourceDesc//tei:imprint/(tei:publisher[@n='thisEd'], tei:publisher[@n='firstEd'])[1]/tei:persName/tokenize(tokenize(@ref,'cerl:')[2], ' ')[1] return element t {$t})</object>
            </statement>
            <statement n="7"><!-- fabio:has publisher (in gnd) -->
                <subject type="uri" prepend="texts/">/($currentResource//@docId)</subject>
                <predicate prefix="fabio">hasPublisher</predicate>
                <object type="uri" prepend="http://d-nb.info/gnd/">/(for $t in $currentResource//tei:sourceDesc//tei:imprint/(tei:publisher[@n='thisEd'], tei:publisher[@n='firstEd'])[1]/tei:persName/tokenize(tokenize(@ref,'gnd:')[2],' ')[1] return element t {$t})</object>
            </statement>
            <statement n="8"><!-- fabio:has volume count -->
                <condition>/($currentResource//tei:relatedItem[@type eq "work_volume"])</condition>
                <subject type="uri" prepend="texts/">/($currentResource//@docId)</subject>
                <predicate prefix="fabio">hasVolumeCount</predicate>
                <object type="literal">/count($currentResource//tei:relatedItem[@type eq "work_volume"])</object>
            </statement>
            
            <statement n="9"><!-- rdfs:seeAlso SvSal work webpage -->
                <subject type="uri" prepend="texts/">/($currentResource//@docId)</subject>
                <predicate prefix="rdfs">seeAlso</predicate>
                <object type="uri" prepend="https://id.salamanca.school/texts/">/($currentResource//@docId)</object>
            </statement>

            
            
<!-- =================================================================== -->
<!-- === II. Document Components: Volumes, Sections, Paragraphs etc. === -->
<!-- =================================================================== -->

<!-- Todo/Document Components:
    - items and lists, of dictionary entries in particular
-->

    <!-- For each document component, we record
            (1) its type,
            (2) a label, and
            (3) by which other component it is contained
            (4) where to find the html version of it -->
    <!-- Volume -->
            <statement n="10" repeat="{/count($currentResource//sal:node[@subtype eq 'work_volume'])}">
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@subtype eq 'work_volume'][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="rdf">type</predicate>
                <object type="uri" prefix="doco">part</object>
            </statement>
            <statement n="11" repeat="{/count($currentResource//sal:node[@subtype eq 'work_volume'])}">
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@subtype eq 'work_volume'][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="rdfs">label</predicate>
                <object type="literal">/concat('Volume ', $repeatIndex)</object>
            </statement>
            <statement n="12" repeat="{/count($currentResource//sal:node[@subtype eq 'work_volume'])}">
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@subtype eq 'work_volume'][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="po">isContainedBy</predicate>
                <object type="uri" prepend="texts/">/@work</object>
            </statement>
            <statement n="13" repeat="{/count($currentResource//sal:node[@subtype eq 'work_volume'])}">
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@subtype eq 'work_volume'][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="rdfs">seeAlso</predicate>
<!--                <object type="uri" prepend="https://www.salamanca.school/">/(.//sal:node[@subtype eq 'work_volume'][$repeatIndex]/sal:crumbtrail/a/@href)[last()]</object>-->
                <object type="uri" prepend="https://www.salamanca.school/">//sal:node[@subtype eq 'work_volume'][$repeatIndex]/sal:crumbtrail/a/@href[last()]</object>
			 </statement>

    <!-- Frontmatter -->        
            <statement n="14" repeat="{/count($currentResource//sal:node[@type eq 'front'])}"><!-- multiple volumes -->
                <condition>/boolean($currentResource//sal:node[@subtype eq "work_volume"]/@subtype)</condition>
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@type eq 'front'][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="rdf">type</predicate>
                <object type="uri" prefix="doco">front-matter</object>
            </statement>
            <statement n="15"><!-- monograph -->
                <condition>/boolean($currentResource//sal:node[@subtype eq "work_monograph"]/@subtype)</condition>
                <subject type="uri" prepend="texts/{/@work}:">frontmatter</subject>
                <predicate prefix="rdf">type</predicate>
                <object type="uri" prefix="doco">front-matter</object>
            </statement>
            <statement n="16" repeat="{/count($currentResource//sal:node[@type eq 'front'])}"><!-- multiple volumes -->
                <condition>/boolean($currentResource//sal:node[@subtype eq "work_volume"]/@subtype)</condition>
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@type eq 'front'][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="rdfs">label</predicate>
                <object type="literal">/concat('frontmatter of volume ', $repeatIndex)</object>
            </statement>
            <statement n="17"><!-- monograph -->
                <condition>/boolean($currentResource//sal:node[@subtype eq "work_monograph"]/@subtype)</condition>
                <subject type="uri" prepend="texts/{/@work}:">frontmatter</subject>
                <predicate prefix="rdfs">label</predicate>
                <object type="literal">frontmatter</object>
            </statement>
            <statement n="18" repeat="{/count($currentResource//sal:node[@type eq 'front'])}"><!-- multiple volumes -->
                <condition>/boolean($currentResource//sal:node[@subtype eq "work_volume"]/@subtype)</condition>
                <subject type="uri" prepend="texts/{/@work}:">/sal:node[@type eq 'front'][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="po">isContainedBy</predicate>
                <object type="uri" prepend="texts/{/@work}:">/(for $t in $currentResource//sal:node[@type eq 'front'][$repeatIndex]/sal:citableParent/text() return $currentResource//sal:node[@n eq $t]/sal:citetrail/text())</object>
            </statement>
            <statement n="19"><!-- monograph -->
                <condition>/boolean($currentResource//sal:node[@subtype eq "work_monograph"]/@subtype)</condition>
                <subject type="uri" prepend="texts/{/@work}:">frontmatter</subject>
                <predicate prefix="po">isContainedBy</predicate>
                <object type="uri" prepend="texts/">/@work</object>
            </statement>
            <statement n="20" repeat="{/count($currentResource//sal:node[@type eq 'front'])}"><!-- multiple volumes -->
                <condition>/boolean($currentResource//sal:node[@subtype eq "work_volume"]/@subtype)</condition>
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@type eq 'front'][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="rdfs">seeAlso</predicate>
                <object type="uri" prepend="https://www.salamanca.school/">//sal:node[@type eq 'front'][$repeatIndex]/sal:crumbtrail/a[last()]/@href</object>
			 </statement>
            <statement n="21"><!-- monograph -->
                <condition>/boolean($currentResource//sal:node[@subtype eq "work_monograph"]/@subtype)</condition>
                <subject type="uri" prepend="texts/{/@work}:">frontmatter</subject>
                <predicate prefix="rdfs">seeAlso</predicate>
                <object type="uri" prepend="https://www.salamanca.school/">//sal:node[@type eq 'front'][1]/sal:crumbtrail/a[last()]/@href</object>
			 </statement>

    <!-- Backmatter -->
            <statement n="22" repeat="{/count($currentResource//sal:node[@type eq 'back'])}"><!-- multiple volumes -->
                <condition>/boolean(.//sal:node[@subtype eq "work_volume"]/@subtype)</condition>
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@type eq 'back'][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="rdf">type</predicate>
                <object type="uri" prefix="doco">back-matter</object>
            </statement>
            <statement n="23"><!-- monograph -->
                <condition>/boolean(.//sal:node[@subtype eq "work_monograph"]/@subtype)</condition>
                <subject type="uri" prepend="texts/{/@work}:">backmatter</subject>
                <predicate prefix="rdf">type</predicate>
                <object type="uri" prefix="doco">back-matter</object>
            </statement>
            <statement n="24" repeat="{/count($currentResource//sal:node[@type eq 'back'])}"><!-- multiple volumes -->
                <condition>/boolean(.//sal:node[@subtype eq "work_volume"]/@subtype)</condition>
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@type eq 'back'][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="rdfs">label</predicate>
<!--                <object type="literal">/concat('backmatter of ', $currentResource//sal:node[@n eq $currentResource//sal:node[@type eq 'back'][$repeatIndex]/sal:citableParent]/sal:title)</object>-->
                <object type="literal">/concat('backmatter of ', (for $t in $currentResource//sal:node[@type eq 'back'][$repeatIndex]/sal:citableParent/text() return $currentResource//sal:node[@n eq $t]/sal:title))</object>
            </statement>
            <statement n="25"><!-- monograph -->
                <condition>/boolean(.//sal:node[@subtype eq "work_monograph"]/@subtype)</condition>
                <subject type="uri" prepend="texts/{/@work}:">backmatter</subject>
                <predicate prefix="rdfs">label</predicate>
                <object type="literal">backmatter</object>
            </statement>
            <statement n="26" repeat="{/count($currentResource//sal:node[@type eq 'back'])}"><!-- multiple volumes -->
                <condition>/boolean(.//sal:node[@subtype eq "work_volume"]/@subtype)</condition>
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@type eq 'back'][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="po">isContainedBy</predicate>
<!--                <object type="uri"  prepend="texts/{/@work}:">//sal:node[@n eq $currentResource//sal:node[@type eq 'back'][$repeatIndex]/sal:citableParent/text()]/sal:citetrail/text()</object>-->
                <object type="uri" prepend="texts/{/@work}:">/(for $t in $currentResource//sal:node[@type eq 'back'][$repeatIndex]/sal:citableParent/text() return $currentResource//sal:node[@n eq $t]/sal:citetrail/text())</object>
            </statement>
            <statement n="27"><!-- monograph -->
                <condition>/boolean(.//sal:node[@subtype eq "work_monograph"]/@subtype)</condition>
                <subject type="uri" prepend="texts/{/@work}:">backmatter</subject>
                <predicate prefix="po">isContainedBy</predicate>
                <object type="uri" prepend="texts/">/@work</object>
            </statement>
            <statement n="28" repeat="{/count($currentResource//sal:node[@type eq 'back'])}"><!-- multiple volumes -->
                <condition>/boolean(.//sal:node[@subtype eq "work_volume"]/@subtype)</condition>
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@type eq 'back'][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="rdfs">seeAlso</predicate>
                <object type="uri" prepend="https://www.salamanca.school/">//sal:node[@type eq 'back'][$repeatIndex]/sal:crumbtrail/a[last()]/@href</object>
			 </statement>
            <statement n="29"><!-- monograph -->
                <condition>/boolean(.//sal:node[@subtype eq "work_monograph"]/@subtype)</condition>
                <subject type="uri" prepend="texts/{/@work}:">backmatter</subject>
                <predicate prefix="rdfs">seeAlso</predicate>
                <object type="uri" prepend="https://www.salamanca.school/">//sal:node[@type eq 'completeWork']/sal:crumbtrail/a[last()]/@href</object>
			 </statement>
        
    <!-- Other section levels: div, p, milestones, lists, items, notes -->
            <statement n="30" repeat="{/min((10020, count($currentResource//sal:node[@type eq 'div'])))}">
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@type eq 'div'][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="rdf">type</predicate>
                <object type="uri" prefix="doco">/(if($currentResource//sal:node[@type eq 'div'][$repeatIndex]/@subtype eq 'book') then 'part' else if ($currentResource//sal:node[@type eq 'div'][$repeatIndex]/@subtype eq 'chapter') then 'chapter' else 'section')</object>
            </statement>
            <statement n="31" repeat="{/min((10020, count($currentResource//sal:node[@type eq 'div'])))}">
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@type eq 'div'][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="rdfs">label</predicate>
                <object type="literal">/replace($currentResource//sal:node[@type eq 'div'][$repeatIndex]/sal:title, '"', '\\"')</object>
            </statement>
            <statement n="32" repeat="{/min((10020, count($currentResource//sal:node[@type eq 'div'])))}">
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@type eq 'div'][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="po">isContainedBy</predicate>
                <object type="uri" prepend="texts/">/string-join(($currentResource/@work, (for $t in $currentResource//sal:node[@type eq 'div'][$repeatIndex]/sal:citableParent/text() return $currentResource//sal:node[@n eq $t]/sal:citetrail/text())), ':')</object>
            </statement>
            <statement n="33" repeat="{/min((10020, count($currentResource//sal:node[@type eq 'div'])))}">
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@type eq 'div'][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="rdfs">seeAlso</predicate>
                <object type="uri" prepend="https://www.salamanca.school/">/($currentResource//sal:node[@type eq 'div'][$repeatIndex]/sal:crumbtrail/a/@href)[last()]</object>
			 </statement>

            <statement n="34" repeat="{/min((10020, count($currentResource//sal:node[@type eq 'p'])))}">
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@type eq 'p'][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="rdf">type</predicate>
                <object type="uri" prefix="doco">paragraph</object>
            </statement>
            <statement n="35" repeat="{/min((10020, count($currentResource//sal:node[@type eq 'p'])))}">
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@type eq 'p'][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="rdfs">label</predicate>
                <object type="literal">/replace($currentResource//sal:node[@type eq 'p'][$repeatIndex]/sal:title, '"', '\\"')</object>
            </statement>
            <statement n="36" repeat="{/min((10020, count($currentResource//sal:node[@type eq 'p'])))}">
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@type eq 'p'][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="po">isContainedBy</predicate>
<!--                <object type="uri"  prepend="texts/">/string-join((./@work, $currentResource//sal:node[@n = $currentResource//sal:node[@type='p'][$repeatIndex]/sal:citableParent]/sal:citetrail/text()), ':')</object>-->
                <object type="uri" prepend="texts/">/string-join(($currentResource/@work, (for $t in $currentResource//sal:node[@type eq 'p'][$repeatIndex]/sal:citableParent/text() return $currentResource//sal:node[@n eq $t]/sal:citetrail/text())), ':')</object>
            </statement>
            <statement n="37" repeat="{/min((10020, count($currentResource//sal:node[@type eq 'p'])))}">
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@type eq 'p'][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="rdfs">seeAlso</predicate>
                <object type="uri" prepend="https://www.salamanca.school/">/($currentResource//sal:node[@type eq 'p'][$repeatIndex]/sal:crumbtrail/a/@href)[last()]</object>
			 </statement>

            <statement n="38" repeat="{/min((10020, count($currentResource//sal:node[@type eq 'milestone'])))}">
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@type='milestone'][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="rdf">type</predicate>
                <object type="uri" prefix="doco">section</object>
            </statement>
            <statement n="39" repeat="{/min((10020, count($currentResource//sal:node[@type eq 'milestone'])))}">
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@type eq 'milestone'][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="rdfs">label</predicate>
                <object type="literal">/replace($currentResource//sal:node[@type eq 'milestone'][$repeatIndex]/sal:title, '"', '\\"')</object>
            </statement>
            <statement n="40" repeat="{/min((10020, count($currentResource//sal:node[@type eq 'milestone'])))}">
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@type eq 'milestone'][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="po">isContainedBy</predicate>
                <object type="uri" prepend="texts/">/string-join(($currentResource/@work, (for $t in $currentResource//sal:node[@type eq 'milestone'][$repeatIndex]/sal:citableParent/text() return $currentResource//sal:node[@n eq $t]/sal:citetrail/text())), ':')</object>
            </statement>
            <statement n="41" repeat="{/min((10020, count($currentResource//sal:node[@type eq 'milestone'])))}">
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@type eq 'milestone'][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="rdfs">seeAlso</predicate>
                <object type="uri" prepend="https://www.salamanca.school/">/($currentResource//sal:node[@type eq 'milestone'][$repeatIndex]/sal:crumbtrail/a/@href)[last()]</object>
			 </statement>

            <statement n="42" repeat="{/min((10010, count($currentResource//sal:node[@type eq 'list'])))}">
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@type eq 'list'][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="rdf">type</predicate>
                <object type="uri" prefix="doco">list</object>
            </statement>
            <statement n="43" repeat="{/min((10010, count($currentResource//sal:node[@type eq 'list'])))}">
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@type eq 'list'][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="rdfs">label</predicate>
                <object type="literal">/replace($currentResource//sal:node[@type eq 'list'][$repeatIndex]/sal:title, '"', '\\"')</object>
            </statement>
            <statement n="44" repeat="{/min((10010, count($currentResource//sal:node[@type eq 'list'])))}">
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@type eq 'list'][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="po">isContainedBy</predicate>
                <object type="uri" prepend="texts/">/string-join(($currentResource/@work, (for $t in $currentResource//sal:node[@type eq 'list'][$repeatIndex]/sal:citableParent/text() return $currentResource//sal:node[@n eq $t]/sal:citetrail/text())), ':')</object>
            </statement>
            <statement n="45" repeat="{/min((10010, count($currentResource//sal:node[@type eq 'list'])))}">
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@type eq 'list'][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="rdfs">seeAlso</predicate>
                <object type="uri" prepend="https://www.salamanca.school/">/($currentResource//sal:node[@type eq 'list'][$repeatIndex]/sal:crumbtrail/a/@href)[last()]</object>
			 </statement>

<!--
            <statement n="46" repeat="{/min((10050, count($currentResource//sal:node[@type eq 'item'])))}">
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@type eq 'item'][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="rdf">type</predicate>
                <object type="uri" prefix="doco">section</object>
            </statement>
            <statement n="47" repeat="{/min((10050, count($currentResource//sal:node[@type eq 'item'])))}">
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@type eq 'item'][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="rdfs">label</predicate>
                <object type="literal">/replace($currentResource//sal:node[@type eq 'item'][$repeatIndex]/sal:title, '"', '\\"')</object>
            </statement>
            <statement n="48" repeat="{/min((10050, count($currentResource//sal:node[@type eq 'item'])))}">
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@type eq 'item'][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="po">isContainedBy</predicate>
                <object type="uri" prepend="texts/">/string-join(($currentResource/@work, (for $t in $currentResource//sal:node[@type eq 'item'][$repeatIndex]/sal:citableParent/text() return $currentResource//sal:node[@n eq $t]/sal:citetrail/text())), ':')</object>
            </statement>
            <statement n="49" repeat="{/min((10050, count($currentResource//sal:node[@type eq 'item'])))}">
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@type eq 'item'][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="rdfs">seeAlso</predicate>
                <object type="uri" prepend="https://www.salamanca.school/">/($currentResource//sal:node[@type eq 'item'][$repeatIndex]/sal:crumbtrail/a/@href)[last()]</object>
			 </statement>
-->

            <statement n="50" repeat="{/min((10050, count($currentResource//sal:node[@type eq 'note'])))}">
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@type eq 'note'][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="rdf">type</predicate>
                <object type="uri" prefix="doco">footnote</object>
            </statement>
            <statement n="51" repeat="{/min((10050, count($currentResource//sal:node[@type eq 'note'])))}">
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@type eq 'note'][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="rdfs">label</predicate>
                <object type="literal">/replace($currentResource//sal:node[@type eq 'note'][$repeatIndex]/sal:title, '"', '\\"')</object>
            </statement>
            <statement n="52" repeat="{/min((10050, count($currentResource//sal:node[@type eq 'note'])))}">
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@type eq 'note'][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="po">isContainedBy</predicate>
                <object type="uri" prepend="texts/">/string-join(($currentResource/@work, (for $t in $currentResource//sal:node[@type eq 'note'][$repeatIndex]/sal:citableParent/text() return $currentResource//sal:node[@n eq $t]/sal:citetrail/text())), ':')</object>
            </statement>
            <statement n="53" repeat="{/min((10050, count($currentResource//sal:node[@type eq 'note'])))}">
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@type eq 'note'][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="rdfs">seeAlso</predicate>
                <object type="uri" prepend="https://www.salamanca.school/">/($currentResource//sal:node[@type eq 'note'][$repeatIndex]/sal:crumbtrail/a/@href)[last()]</object>
			 </statement>


<!-- ==================================== -->
<!-- === III. Physical Aspects: Pages === -->
<!-- ==================================== -->

            <!-- Pages -->
            <statement n="54" repeat="{/min((10050, count($currentResource//sal:node[@type eq 'pb'][not(@subtype='sameAs')])))}">
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@type eq 'pb'][not(@subtype eq 'sameAs')][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="rdf">type</predicate>
                <object type="uri" prefix="fabio">page</object>
            </statement>
            <statement n="55" repeat="{/min((10050, count($currentResource//sal:node[@type eq 'pb'][not(@subtype='sameAs')])))}">
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@type eq 'pb'][not(@subtype eq 'sameAs')][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="rdfs">label</predicate>
                <object type="literal">/replace(normalize-space($currentResource//sal:node[@type eq 'pb'][not(@subtype eq 'sameAs')][$repeatIndex]/sal:title), '"', '\\"')</object>
            </statement>
            <statement n="56" repeat="{/min((10050, count($currentResource//sal:node[@type eq 'pb'][not(@subtype='sameAs')])))}">
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@type eq 'pb'][not(@subtype eq 'sameAs')][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="po">isContainedBy</predicate>
                <object type="uri" prepend="texts/">/concat($currentResource/@work, if(functx:substring-before-last($currentResource//sal:node[@type eq 'pb'][not(@subtype eq 'sameAs')][$repeatIndex]/sal:citetrail, '.')) then ':' else (), functx:substring-before-last($currentResource//sal:node[@type eq 'pb'][not(@subtype eq 'sameAs')][$repeatIndex]/sal:citetrail, '.'))</object>
            </statement>
            <statement n="57" repeat="{/min((10050, count($currentResource//sal:node[@type eq 'pb'][not(@subtype='sameAs')])))}">
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@type eq 'pb'][not(@subtype eq 'sameAs')][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="rdfs">seeAlso</predicate>
                <object type="uri" prepend="http://facs.salamanca.school/{/@work}/">/concat(replace(string-join(functx:get-matches(substring($currentResource//sal:node[@type eq 'pb'][not(@subtype eq 'sameAs')][$repeatIndex]/@n, 12), '[A-Z-]'), ''), '-', '/'), substring($currentResource//sal:node[@type eq 'pb'][not(@subtype eq 'sameAs')][$repeatIndex]/@n[1], 6), '.jpg')</object>
			 </statement>
            <statement n="58" repeat="{/min((10050, count($currentResource//sal:node[@type eq 'pb'][not(@subtype='sameAs')])))}">
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@type eq 'pb'][not(@subtype eq 'sameAs')][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="rdfs">seeAlso</predicate>
                <object type="uri" prepend="https://www.salamanca.school/">/($currentResource//sal:node[@type eq 'pb'][not(@subtype eq 'sameAs')][$repeatIndex]/sal:crumbtrail/a/@href)[last()]</object>
			 </statement>
            
            

            <!-- iiif stuff -->
<!-- Todo/iiif:
    - Other iiif stuff: label, height, width, thumbnail, otherContent, startCanvas (per work, not per page)
    - blank node for image resource
    - blank node for annotation mentioning image resource
    - iiif:images contains annotations
-->
            <statement n="59" repeat="{/min((10050, count($currentResource//sal:node[@type eq 'pb'][not(@subtype='sameAs')])))}">
                <subject type="uri" prepend="texts/{/@work}:">//sal:node[@type eq 'pb'][not(@subtype eq 'sameAs')][$repeatIndex]/sal:citetrail/text()</subject>
                <predicate prefix="rdf">type</predicate>
                <object type="uri" prefix="iiif">canvas</object>
            </statement>


<!-- ====================== -->
<!-- === IV. References === -->
<!-- ====================== -->

<!-- Todo/References:
    - render persons who are mentioned, but not cited as authors
-->

    <!-- a. References within citations (<cit>): We render this with cito:includesQuotationFrom -->

    <!-- a.1. ... to work titles (-> CitationAct_a_XY-## blank nodes) -->
            <!-- SvSal works -->
			 <statement n="60" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:cit//tei:title[contains(@ref, 'work:')])))}"><!-- A CitationAct event... -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_a_', $currentResource/@work, '-works-', $repeatIndex)</subject>
				<predicate prefix="rdf">type</predicate>
				<object type="uri" prefix="cito">citationAct</object>
			 </statement>
			 <statement n="61" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:cit//tei:title[contains(@ref, 'work:')])))}"><!-- ... of type... -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_a_', $currentResource/@work, '-works-', $repeatIndex)</subject>
				<predicate prefix="cito">hasCitationCharacterization</predicate>
				<object type="uri" prefix="cito">includesQuotationFrom</object>
			 </statement>
			 <statement n="62" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:cit//tei:title[contains(@ref, 'work:')])))}"><!-- ... what is cited? -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_a_', $currentResource/@work, '-works-', $repeatIndex)</subject>
				<predicate prefix="cito">hasCitedEntity</predicate>
				<object type="uri" prepend="texts/" resource="https://tei.salamanca.school/{/@work}.xml">/(//tei:text//tei:cit//tei:title[contains(@ref, 'work:')])[$repeatIndex]/tokenize(tokenize(@ref, 'work:')[2], ' ')[1]</object>
			 </statement>
			 <statement n="63" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:cit//tei:title[contains(@ref, 'work:')])))}"><!-- ... where is the citation? -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_a_', $currentResource/@work, '-works-', $repeatIndex)</subject>
              <predicate prefix="cito">hasCitingEntity</predicate><!-- or po:isContainedBy? -->
		       <object type="uri" prepend="texts/{/@work}:" resource="https://tei.salamanca.school/{/@work}.xml">($currentResource//sal:node[@n = (($externalResource//tei:text//tei:cit//tei:title[contains(@ref, 'work:')])[$repeatIndex]/(ancestor::tei:p|ancestor::tei:div))[last()]/@xml:id/string()]/sal:citetrail/text())</object>
			 </statement>
            <!-- OCLC works -->
			 <statement n="64" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:cit//tei:title[contains(@ref, 'oclc:')])))}"><!-- A CitationAct event... -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_a_', $currentResource/@work, '-oclc-', $repeatIndex)</subject>
				<predicate prefix="rdf">type</predicate>
				<object type="uri" prefix="cito">citationAct</object>
			 </statement>
			 <statement n="65" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:cit//tei:title[contains(@ref, 'oclc:')])))}"><!-- ... of type... -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_a_', $currentResource/@work, '-oclc', $repeatIndex)</subject>
				<predicate prefix="cito">hasCitationCharacterization</predicate>
				<object type="uri" prefix="cito">includesQuotationFrom</object>
			 </statement>
			 <statement n="66" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:cit//tei:title[contains(@ref, 'oclc:')])))}"><!-- ... what is cited? -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_a_', $currentResource/@work, '-oclc-', $repeatIndex)</subject>
				<predicate prefix="cito">hasCitedEntity</predicate>
				<object type="uri" prepend="http://www.worldcat.org/oclc/" resource="https://tei.salamanca.school/{/@work}.xml">/(//tei:text//tei:cit//tei:title[contains(@ref, 'oclc:')])[$repeatIndex]/tokenize(tokenize(@ref, 'oclc:')[2], ' ')[1]</object>
			 </statement>
			 <statement n="67" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:cit//tei:title[contains(@ref, 'oclc:')])))}"><!-- ... where is the citation? -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_a_', $currentResource/@work, '-oclc-', $repeatIndex)</subject>
              <predicate prefix="cito">hasCitingEntity</predicate><!-- or po:isContainedBy? -->
		       <object type="uri" prepend="texts/{/@work}:" resource="https://tei.salamanca.school/{/@work}.xml">($currentResource//sal:node[@n = (($externalResource//tei:text//tei:cit//tei:title[contains(@ref, 'oclc:')])[$repeatIndex]/(ancestor::tei:p|ancestor::tei:div))[last()]/@xml:id/string()]/sal:citetrail/text())</object>
			 </statement>
            <!-- GND works -->
			 <statement n="68" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:cit//tei:title[contains(@ref, 'gnd:')])))}"><!-- A CitationAct event... -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_a_', $currentResource/@work, '-gnd-', $repeatIndex)</subject>
				<predicate prefix="rdf">type</predicate>
				<object type="uri" prefix="cito">citationAct</object>
			 </statement>
			 <statement n="69" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:cit//tei:title[contains(@ref, 'gnd:')])))}"><!-- ... of type... -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_a_', $currentResource/@work, '-gnd-', $repeatIndex)</subject>
				<predicate prefix="cito">hasCitationCharacterization</predicate>
				<object type="uri" prefix="cito">includesQuotationFrom</object>
			 </statement>
			 <statement n="70" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:cit//tei:title[contains(@ref, 'gnd:')])))}"><!-- ... what is cited? -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_a_', $currentResource/@work, '-gnd-', $repeatIndex)</subject>
				<predicate prefix="cito">hasCitedEntity</predicate>
				<object type="uri" prepend="http://d-nb.info/gnd/" resource="https://tei.salamanca.school/{/@work}.xml">/(//tei:text//tei:cit//tei:title[contains(@ref, 'gnd:')])[$repeatIndex]/tokenize(tokenize(@ref, 'gnd:')[2], ' ')[1]</object>
			 </statement>
			 <statement n="71" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:cit//tei:title[contains(@ref, 'gnd:')])))}"><!-- ... where is the citation? -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_a_', $currentResource/@work, '-gnd-', $repeatIndex)</subject>
              <predicate prefix="cito">hasCitingEntity</predicate><!-- or po:isContainedBy? -->
		       <object type="uri" prepend="texts/{/@work}:" resource="https://tei.salamanca.school/{/@work}.xml">($currentResource//sal:node[@n = (($externalResource//tei:text//tei:cit//tei:title[contains(@ref, 'gnd:')])[$repeatIndex]/(ancestor::tei:p|ancestor::tei:div))[last()]/@xml:id/string()]/sal:citetrail/text())</object>
			 </statement>

    <!-- a.2. ... to authors (CitationAct_b_XY-## blank nodes) -->
            <!-- SvSal authors -->
			 <statement n="72" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:cit//tei:author/tei:persName[contains(@ref, 'author:')])))}"><!-- A CitationAct event... -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_b_-', $currentResource/@work, '-authors-', $repeatIndex)</subject>
				<predicate prefix="rdf">type</predicate>
				<object type="uri" prefix="cito">citationAct</object>
			 </statement>
			 <statement n="73" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:cit//tei:author/tei:persName[contains(@ref, 'author:')])))}"><!-- ... of type... -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_b_', $currentResource/@work, '-authors-', $repeatIndex)</subject>
				<predicate prefix="cito">hasCitationCharacterization</predicate>
				<object type="uri" prefix="cito">citesAsRelated</object>
			 </statement>
			 <statement n="74" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:cit//tei:author/tei:persName[contains(@ref, 'author:')])))}"><!-- ... what is cited? -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_b_', $currentResource/@work, '-authors-, $repeatIndex)</subject>
				<predicate prefix="cito">hasCitedEntity</predicate>
				<object type="uri" prepend="authors." resource="https://tei.salamanca.school/{/@work}.xml">/(//tei:text//tei:cit//tei:author/tei:persName[contains(@ref, 'author:')])[$repeatIndex]/tokenize(tokenize(@ref, 'author:')[2], ' ')[1]</object>
			 </statement>
			 <statement n="75" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:cit//tei:author/tei:persName[contains(@ref, 'author:')])))}"><!-- ... where is the citation? -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_b_', $currentResource/@work, '-authors-', $repeatIndex)</subject>
              <predicate prefix="cito">hasCitingEntity</predicate><!-- or po:isContainedBy? -->
		       <object type="uri" prepend="texts/{/@work}:" resource="https://tei.salamanca.school/{/@work}.xml">($currentResource//sal:node[@n = (($externalResource//tei:text//tei:cit//tei:author/tei:persName[contains(@ref, 'author:')])[$repeatIndex]/(ancestor::tei:p|ancestor::tei:div))[last()]/@xml:id/string()]/sal:citetrail/text())</object>
			 </statement>
            <!-- Cerl authors -->
			 <statement n="76" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:cit//tei:author/tei:persName[contains(@ref, 'cerl:')])))}"><!-- A CitationAct event... -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_b_', $currentResource/@work, '-cerl-', $repeatIndex)</subject>
				<predicate prefix="rdf">type</predicate>
				<object type="uri" prefix="cito">citationAct</object>
			 </statement>
			 <statement n="77" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:cit//tei:author/tei:persName[contains(@ref, 'cerl:')])))}"><!-- ... of type... -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_b_', $currentResource/@work, '-cerl-', $repeatIndex)</subject>
				<predicate prefix="cito">hasCitationCharacterization</predicate>
				<object type="uri" prefix="cito">citesAsRelated</object>
			 </statement>
			 <statement n="78" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:cit//tei:author/tei:persName[contains(@ref, 'cerl:')])))}"><!-- ... what is cited? -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_b_', $currentResource/@work, '-cerl-', $repeatIndex)</subject>
				<predicate prefix="cito">hasCitedEntity</predicate>
				<object type="uri" prepend="http://thesaurus.cerl.org/record/" resource="https://tei.salamanca.school/{/@work}.xml">/(//tei:text//tei:cit//tei:author/tei:persName[contains(@ref, 'cerl:')])[$repeatIndex]/tokenize(tokenize(@ref, 'cerl:')[2], ' ')[1]</object>
			 </statement>
			 <statement n="79" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:cit//tei:author/tei:persName[contains(@ref, 'cerl:')])))}"><!-- ... where is the citation? -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_b_', $currentResource/@work, '-cerl-', $repeatIndex)</subject>
              <predicate prefix="cito">hasCitingEntity</predicate><!-- or po:isContainedBy? -->
		       <object type="uri" prepend="texts/{/@work}:" resource="https://tei.salamanca.school/{/@work}.xml">($currentResource//sal:node[@n = (($externalResource//tei:text//tei:cit//tei:author/tei:persName[contains(@ref, 'cerl:')])[$repeatIndex]/(ancestor::tei:p|ancestor::tei:div))[last()]/@xml:id/string()]/sal:citetrail/text())</object>
			 </statement>
            <!-- GND authors -->
			 <statement n="80" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:cit//tei:author/tei:persName[contains(@ref, 'gnd:')])))}"><!-- A CitationAct event... -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_b_', $currentResource/@work, '-gnd-', $repeatIndex)</subject>
				<predicate prefix="rdf">type</predicate>
				<object type="uri" prefix="cito">citationAct</object>
			 </statement>
			 <statement n="81" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:cit//tei:author/tei:persName[contains(@ref, 'gnd:')])))}"><!-- ... of type... -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_b_', $currentResource/@work, '-gnd-', $repeatIndex)</subject>
				<predicate prefix="cito">hasCitationCharacterization</predicate>
				<object type="uri" prefix="cito">citesAsRelated</object>
			 </statement>
			 <statement n="82" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:cit//tei:author/tei:persName[contains(@ref, 'gnd:')])))}"><!-- ... what is cited? -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_b_', $currentResource/@work, '-gnd-', $repeatIndex)</subject>
				<predicate prefix="cito">hasCitedEntity</predicate>
				<object type="uri" prepend="http://d-nb.info/gnd/" resource="https://tei.salamanca.school/{/@work}.xml">/(//tei:text//tei:cit//tei:author/tei:persName[contains(@ref, 'gnd:')])[$repeatIndex]/tokenize(tokenize(@ref, 'gnd:')[2], ' ')[1]</object>
			 </statement>
			 <statement n="83" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:cit//tei:author/tei:persName[contains(@ref, 'gnd:')])))}"><!-- ... where is the citation? -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_b_', $currentResource/@work, '-gnd-', $repeatIndex)</subject>
              <predicate prefix="cito">hasCitingEntity</predicate><!-- or po:isContainedBy? -->
		       <object type="uri" prepend="texts/{/@work}:" resource="https://tei.salamanca.school/{/@work}.xml">($currentResource//sal:node[@n = (($externalResource//tei:text//tei:cit//tei:author/tei:persName[contains(@ref, 'gnd:')])[$repeatIndex]/(ancestor::tei:p|ancestor::tei:div))[last()]/@xml:id/string()]/sal:citetrail/text())</object>
			 </statement>

    <!-- b. References outside of citations: We render this with cito:citesAsRelated -->

    <!-- b.1. ... to work titles (-> CitationAct_c_XY-## blank nodes) -->
            <!-- SvSal works -->
			 <statement n="84" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:title[contains(@ref, 'work:')][not(ancestor::tei:cit)])))}"><!-- A CitationAct event... -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_c_', $currentResource/@work, '-works-', $repeatIndex)</subject>
				<predicate prefix="rdf">type</predicate>
				<object type="uri" prefix="cito">citationAct</object>
			 </statement>
			 <statement n="85" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:title[contains(@ref, 'work:')][not(ancestor::tei:cit)])))}"><!-- ... of type... -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_c_', $currentResource/@work, '-works-', $repeatIndex)</subject>
				<predicate prefix="cito">hasCitationCharacterization</predicate>
				<object type="uri" prefix="cito">citesAsRelated</object>
			 </statement>
			 <statement n="86" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:title[contains(@ref, 'work:')][not(ancestor::tei:cit)])))}"><!-- ... what is cited? -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_c_', $currentResource/@work, '-works-', $repeatIndex)</subject>
				<predicate prefix="cito">hasCitedEntity</predicate>
				<object type="uri" prepend="texts/" resource="https://tei.salamanca.school/{/@work}.xml">/($externalResource//tei:text//tei:title[contains(@ref, 'work:')][not(ancestor::tei:cit)])[$repeatIndex]/tokenize(tokenize(@ref, 'work:')[2], ' ')[1]</object>
			 </statement>
			 <statement n="87" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:title[contains(@ref, 'work:')][not(ancestor::tei:cit)])))}"><!-- ... where is the citation? -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_c_', $currentResource/@work, '-works-', $repeatIndex)</subject>
              <predicate prefix="cito">hasCitingEntity</predicate>
		       <object type="uri" prepend="texts/{/@work}:" resource="https://tei.salamanca.school/{/@work}.xml">($currentResource//sal:node[@n = (($externalResource//tei:text//tei:title[contains(@ref, 'work:')][not(ancestor::tei:cit)])[$repeatIndex]/(ancestor::tei:p|ancestor::tei:div))[last()]/@xml:id/string()]/sal:citetrail/text())</object>
			 </statement>
            <!-- OCLC works -->
			 <statement n="88" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:title[contains(@ref, 'oclc:')][not(ancestor::tei:cit)])))}"><!-- A CitationAct event... -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_c_', $currentResource/@work, '-oclc-', $repeatIndex)</subject>
				<predicate prefix="rdf">type</predicate>
				<object type="uri" prefix="cito">citationAct</object>
			 </statement>
			 <statement n="89" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:title[contains(@ref, 'oclc:')][not(ancestor::tei:cit)])))}"><!-- ... of type... -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_c_', $currentResource/@work, '-oclc-', $repeatIndex)</subject>
				<predicate prefix="cito">hasCitationCharacterization</predicate>
				<object type="uri" prefix="cito">citesAsRelated</object>
			 </statement>
			 <statement n="90" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:title[contains(@ref, 'oclc:')][not(ancestor::tei:cit)])))}"><!-- ... what is cited? -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_c_', $currentResource/@work, '-oclc-', $repeatIndex)</subject>
				<predicate prefix="cito">hasCitedEntity</predicate>
				<object type="uri" prepend="http://www.worldcat.org/oclc/" resource="https://tei.salamanca.school/{/@work}.xml">/($externalResource//tei:text//tei:title[contains(@ref, 'oclc:')][not(ancestor::tei:cit)])[$repeatIndex]/tokenize(tokenize(@ref, 'oclc:')[2], ' ')[1]</object>
			 </statement>
			 <statement n="91" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:title[contains(@ref, 'oclc:')][not(ancestor::tei:cit)])))}"><!-- ... where is the citation? -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_c_', $currentResource/@work, '-oclc-', $repeatIndex)</subject>
              <predicate prefix="cito">hasCitingEntity</predicate><!-- or po:isContainedBy? -->
		       <object type="uri" prepend="texts/{/@work}:" resource="https://tei.salamanca.school/{/@work}.xml">($currentResource//sal:node[@n = (($externalResource//tei:text//tei:title[contains(@ref, 'oclc:')][not(ancestor::tei:cit)])[$repeatIndex]/(ancestor::tei:p|ancestor::tei:div))[last()]/@xml:id/string()]/sal:citetrail/text())</object>
			 </statement>
            <!-- GND works -->
			 <statement n="92" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:title[contains(@ref, 'gnd:')][not(ancestor::tei:cit)])))}"><!-- A CitationAct event... -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_c_', $currentResource/@work, '-gnd-', $repeatIndex)</subject>
				<predicate prefix="rdf">type</predicate>
				<object type="uri" prefix="cito">citationAct</object>
			 </statement>
			 <statement n="93" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:title[contains(@ref, 'gnd:')][not(ancestor::tei:cit)])))}"><!-- ... of type... -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_c_', $currentResource/@work, '-gnd-', $repeatIndex)</subject>
				<predicate prefix="cito">hasCitationCharacterization</predicate>
				<object type="uri" prefix="cito">citesAsRelated</object>
			 </statement>
			 <statement n="94" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:title[contains(@ref, 'gnd:')][not(ancestor::tei:cit)])))}"><!-- ... what is cited? -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_c_', $currentResource/@work, '-gnd-', $repeatIndex)</subject>
				<predicate prefix="cito">hasCitedEntity</predicate>
				<object type="uri" prepend="http://d-nb.info/gnd/" resource="https://tei.salamanca.school/{/@work}.xml">/($externalResource//tei:text//tei:title[contains(@ref, 'gnd:')][not(ancestor::tei:cit)])[$repeatIndex]/tokenize(tokenize(@ref, 'gnd:')[2], ' ')[1]</object>
			 </statement>
			 <statement n="95" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:title[contains(@ref, 'gnd:')][not(ancestor::tei:cit)])))}"><!-- ... where is the citation? -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_c_', $currentResource/@work, '-gnd-', $repeatIndex)</subject>
              <predicate prefix="cito">hasCitingEntity</predicate><!-- or po:isContainedBy? -->
		       <object type="uri" prepend="texts/{/@work}:" resource="https://tei.salamanca.school/{/@work}.xml">($currentResource//sal:node[@n = (($externalResource//tei:text//tei:title[contains(@ref, 'gnd:')][not(ancestor::tei:cit)])[$repeatIndex]/(ancestor::tei:p|ancestor::tei:div))[last()]/@xml:id/string()]/sal:citetrail/text())</object>
			 </statement>

    <!-- b.2. ... to authors (-> CitationAct_d_XY-## blank nodes) -->
            <!-- SvSal authors -->
			 <statement n="96" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:persName[contains(@ref, 'author:')][not(ancestor::tei:cit)])))}"><!-- A CitationAct event... -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_d_', $currentResource/@work, '-authors-', $repeatIndex)</subject>
				<predicate prefix="rdf">type</predicate>
				<object type="uri" prefix="cito">citationAct</object>
			 </statement>
			 <statement n="97" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:persName[contains(@ref, 'author:')][not(ancestor::tei:cit)])))}"><!-- ... of type... -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_d_', $currentResource/@work, '-authors-', $repeatIndex)</subject>
				<predicate prefix="cito">hasCitationCharacterization</predicate>
				<object type="uri" prefix="cito">citesAsRelated</object>
			 </statement>
			 <statement n="98" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:persName[contains(@ref, 'author:')][not(ancestor::tei:cit)])))}"><!-- ... what is cited? -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_d_', $currentResource/@work, '-authors-', $repeatIndex)</subject>
				<predicate prefix="cito">hasCitedEntity</predicate>
				<object type="uri" prepend="authors." resource="https://tei.salamanca.school/{/@work}.xml">/($externalResource//tei:text//tei:persName[contains(@ref, 'author:')][not(ancestor::tei:cit)])[$repeatIndex]/tokenize(tokenize(@ref, 'author:')[2], ' ')[1]</object>
			 </statement>
			 <statement n="99" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:persName[contains(@ref, 'author:')][not(ancestor::tei:cit)])))}"><!-- ... where is the citation? -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_d_', $currentResource/@work, '-authors-', $repeatIndex)</subject>
              <predicate prefix="cito">hasCitingEntity</predicate><!-- or po:isContainedBy? -->
		       <object type="uri" prepend="texts/{/@work}:" resource="https://tei.salamanca.school/{/@work}.xml">($currentResource//sal:node[@n = (($externalResource//tei:text//tei:persName[contains(@ref, 'author:')][not(ancestor::tei:cit)])[$repeatIndex]/(ancestor::tei:p|ancestor::tei:div))[last()]/@xml:id/string()]/sal:citetrail/text())</object>
			 </statement>
            <!-- Cerl authors -->
			 <statement n="100" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:persName[contains(@ref, 'cerl:')][not(ancestor::tei:cit)])))}"><!-- A CitationAct event... -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_d_', $currentResource/@work, '-cerl-', $repeatIndex)</subject>
				<predicate prefix="rdf">type</predicate>
				<object type="uri" prefix="cito">citationAct</object>
			 </statement>
			 <statement n="101" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:persName[contains(@ref, 'cerl:')][not(ancestor::tei:cit)])))}"><!-- ... of type... -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_d_', $currentResource/@work, '-cerl-', $repeatIndex)</subject>
				<predicate prefix="cito">hasCitationCharacterization</predicate>
				<object type="uri" prefix="cito">citesAsRelated</object>
			 </statement>
			 <statement n="102" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:persName[contains(@ref, 'cerl:')][not(ancestor::tei:cit)])))}"><!-- ... what is cited? -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_d_', $currentResource/@work, '-cerl-', $repeatIndex)</subject>
				<predicate prefix="cito">hasCitedEntity</predicate>
				<object type="uri" prepend="http://thesaurus.cerl.org/record/" resource="https://tei.salamanca.school/{/@work}.xml">/($externalResource//tei:text//tei:persName[contains(@ref, 'cerl:')][not(ancestor::tei:cit)])[$repeatIndex]/tokenize(tokenize(@ref, 'cerl:')[2], ' ')[1]</object>
			 </statement>
			 <statement n="103" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:persName[contains(@ref, 'cerl:')][not(ancestor::tei:cit)])))}"><!-- ... where is the citation? -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_d_', $currentResource/@work, '-cerl-', $repeatIndex)</subject>
              <predicate prefix="cito">hasCitingEntity</predicate><!-- or po:isContainedBy? -->
		       <object type="uri" prepend="texts/{/@work}:" resource="https://tei.salamanca.school/{/@work}.xml">($currentResource//sal:node[@n = (($externalResource//tei:text//tei:persName[contains(@ref, 'cerl:')][not(ancestor::tei:cit)])[$repeatIndex]/(ancestor::tei:p|ancestor::tei:div))[last()]/@xml:id/string()]/sal:citetrail/text())</object>
			 </statement>
            <!-- GND authors -->
			 <statement n="104" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:persName[contains(@ref, 'gnd:')][not(ancestor::tei:cit)])))}"><!-- A CitationAct event... -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_d_', $currentResource/@work, '-gnd-', $repeatIndex)</subject>
				<predicate prefix="rdf">type</predicate>
				<object type="uri" prefix="cito">citationAct</object>
			 </statement>
			 <statement n="105" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:persName[contains(@ref, 'gnd:')][not(ancestor::tei:cit)])))}"><!-- ... of type... -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_d_', $currentResource/@work, '-gnd-', $repeatIndex)</subject>
				<predicate prefix="cito">hasCitationCharacterization</predicate>
				<object type="uri" prefix="cito">citesAsRelated</object>
			 </statement>
			 <statement n="106" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:persName[contains(@ref, 'gnd:')][not(ancestor::tei:cit)])))}"><!-- ... what is cited? -->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_d_', $currentResource/@work, '-gnd-', $repeatIndex)</subject>
				<predicate prefix="cito">hasCitedEntity</predicate>
				<object type="uri" prepend="http://d-nb.info/gnd/" resource="https://tei.salamanca.school/{/@work}.xml">/($externalResource//tei:text//tei:persName[contains(@ref, 'gnd:')][not(ancestor::tei:cit)])[$repeatIndex]/tokenize(tokenize(@ref, 'gnd:')[2], ' ')[1]</object>
			 </statement>

<!-- Perhaps search ancestors also for dict items: ancestor::tei:item[ancestor::tei:list/@type='dict'] -->
<!-- 
			 <statement n="107" debug="true" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:persName[contains(@ref, 'gnd:')][not(ancestor::tei:cit)])))}"><!-/- ... where is the citation? -/->
				<subject type="bnode" resource="https://tei.salamanca.school/{/@work}.xml">/concat('CitationAct_d_', $currentResource/@work, '-gnd-', $repeatIndex)</subject>
              <predicate prefix="cito">hasCitingEntity</predicate><!-/- or po:isContainedBy? -/->
		       <object type="uri" prepend="texts/{/@work}:" resource="https://tei.salamanca.school/{/@work}.xml">($currentResource//sal:node[@n = (($externalResource//tei:text//tei:persName[contains(@ref, 'gnd:')][not(ancestor::tei:cit)])[$repeatIndex]/(ancestor::tei:p|ancestor::tei:div))[last()]/@xml:id/string()]/sal:citetrail/text())</object>
			 </statement>
-->

    <!-- c. References to non-literary entities (places, organizations etc.): We render this with book:mentions -->
            <!-- Getty places (independently of whether or not inside a citation) -->
            <statement n="111" repeat="{/min((10010, count(doc('https://tei.salamanca.school/' || @work || '.xml')//tei:text//tei:placeName[contains(@ref, 'getty:')])))}">
                <subject type="uri" prepend="texts/">/@work</subject>
                <predicate prefix="book">mentions</predicate>
                <object type="uri" prepend="http://vocab.getty.edu/tgn/" resource="https://tei.salamanca.school/{/@work}.xml">/($externalResource//tei:text//tei:placeName[contains(@ref, 'getty:')])[$repeatIndex]/tokenize(tokenize(@ref, 'getty:')[2], ' ')[1]</object>
            </statement>
            
            

        </triples>
    </configuration>

    <!-- This is likely to be overwritten by createConfig.xql -->
    <collection uri="https://tei.salamanca.school/W0013_nodeIndex.xml">
        <resource uri="{//sal:index}"/>
    </collection>
</xtriples>